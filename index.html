<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gewichtetes Haushaltseinkommen</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      max-width: 600px;
      margin: auto;
    }
    label, input {
      display: block;
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }
    input {
      padding: 0.5rem;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      padding: 0.7rem 1.2rem;
      font-size: 1rem;
      background-color: #1976d2;
      color: white;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
    }
    #result {
      margin-top: 2rem;
      font-size: 1.2rem;
      font-weight: bold;
    }
    canvas {
      margin-top: 2rem;
    }
  </style>
</head>
<body>
  <h2>Gewichtetes Haushaltseinkommen berechnen</h2>
  <label for="adults">Anzahl der Erwachsenen (14+ Jahre):</label>
  <input type="number" id="adults" min="1" placeholder="z. B. 2" />

  <label for="children">Anzahl der Kinder (unter 14 Jahren):</label>
  <input type="number" id="children" min="0" placeholder="z. B. 1" />

  <label for="income">Jahreshaushaltseinkommen (€):</label>
  <input type="text" id="income" value="50.000" />

  <button onclick="calculateIncome()">Berechnen</button>

  <div id="result"></div>
  <canvas id="chart" width="400" height="300"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const incomeInput = document.getElementById("income");
    const chartCanvas = document.getElementById("chart");
    let chart;
    let quartileCounts = [0, 0, 0, 0];

    // Tausendertrennzeichen live formatieren
    incomeInput.addEventListener("input", (e) => {
      const raw = e.target.value.replace(/\D/g, "");
      e.target.value = Number(raw).toLocaleString("de-DE");
    });

    function sendToGoogleSheet(weightedIncome) {
      const endpoint = "https://script.google.com/macros/s/AKfycbzRWxtGey1AqVqBaCewVbITnjvM4f5Gbc2Vt3v077GjTEe5Vrcc0Xsw3G0YvO1Ar4Sd-g/exec";

      fetch(endpoint, {
        method: "POST",
        body: JSON.stringify({
          gewichtetesEinkommen: weightedIncome
        }),
        headers: {
          "Content-Type": "application/json"
        }
      })
      .then(res => console.log("Gesendet an Google Sheets:", weightedIncome))
      .catch(err => console.error("Fehler beim Senden:", err));
    }

    function updateChart() {
      if (chart) chart.destroy();
      chart = new Chart(chartCanvas, {
        type: "bar",
        data: {
          labels: ["0–24
